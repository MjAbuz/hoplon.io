(page "index.html"
      (:require-macros
        [bootstrap.code              :as code])
      (:require
        [io.hoplon                   :as hoplon]
        [io.hoplon.content.home      :as home]
        [io.hoplon.content.getting-started :as getting-started]
        [io.hoplon.content.docs      :as docs]
        [io.hoplon.content.talks     :as talks]
        [io.hoplon.content.community :as community]
        [bootstrap.core              :as core]
        [bootstrap.page              :as page]
        [tailrecursion.hoplon.util   :as hutil]))

(def route (route-cell "#/home/"))

(defc gs-tasks {:cur nil :toc []})
(defc hdocs    {:cur nil :toc []})
(defc htalks   {:cur nil :toc []})

(with-page-load (.. js/window -location reload))

(def-values
  [page-setup
   nav-bar
   content-home
   content-getting-started
   content-docs
   content-talks
   content-community]
  (page/navbar-fixed-top
    route
    "Hoplon"
    [(a :href "#/home/"                       "Home") (div)]
    [(a :href "#/getting-started/" "Getting Started") (core/container)]
    [(a :href "#/docs/"                       "Docs") (core/container)]
    [(a :href "#/talks/"            "Talking Hoplon") (core/container)]
    [(a :href "#/community/"  "Community/Contribute") (core/container)]))

(def gs-info (partial hoplon/gs-block :type :info))
(def gs-task (partial hoplon/gs-block :toc gs-tasks :type :primary))
(def hdoc    (partial hoplon/gs-block :toc hdocs  :type :primary))
(def htalk   (partial hoplon/gs-block :toc htalks  :type :info))

(html
  :lang "en"
  (head
    (html-meta
      :charset "utf-8")
    page-setup
    (html-meta
      :name    "keywords"
      :content "clojure, clojurescript, cqrs, castra, cljson, spa")
    (html-meta
      :name    "description"
      :content "Hoplon provides a number of libraries promoting a simpler model for Clojure/ClojureScript web applications.")
    (title "Hoplon â€¢ A simpler way to program the web with Clojure and ClojureScript"))
  (body
    (div
      (nav-bar)
      (a
       :class "topfix"
       :do-scroll-to (cell= route))
      (noscript
        (div
          :class "nojs-error"
          "This page uses JavaScript but it looks like you have it turned off."))
      (content-home            :style "display:none" (home/show))
      (content-getting-started :style "display:none" (getting-started/show gs-task gs-tasks gs-info))
      (content-docs            :style "display:none" (docs/show hdoc hdocs))
      (content-talks           :style "display:none" (talks/show htalk htalks))
      (content-community       :style "display:none" (community/show)))))

