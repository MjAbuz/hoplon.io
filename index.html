<!DOCTYPE html>
<html><head><meta charset="utf-8"><script src="main.js" type="text/javascript"></script><script type="text/javascript">tailrecursion.hoplon.app_pages._index_DOT_html.hoploninit();</script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="css/bootstrap.min.css" rel="stylesheet" media="screen"><link href="css/starter-template.css" rel="stylesheet" media="screen"><meta name="keywords" content="clojure, clojurescript, cqrs, castra, cljson, spa"><meta name="description" content="Hoplon provides a number of libraries promoting a simpler model for Clojure/ClojureScript web applications."><title>Hoplon • A simpler way to program the web with Clojure and ClojureScript</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><a shape="rect" class="navbar-brand" href="#/home/">Hoplon</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a shape="rect" href="#/home/">Home</a></li><li><a shape="rect" href="#/getting-started/">Getting Started</a></li><li><a shape="rect" href="#/docs/">Docs</a></li><li><a shape="rect" href="#/talks/">Talking Hoplon</a></li><li><a shape="rect" href="#/community/">Community/Contribute</a></li></ul></div></div></div><a shape="rect" class="topfix"></a><noscript><div class="nojs-error">This page uses JavaScript but it looks like you have it turned off.</div></noscript><div><div class="jumbotron" style="background-color:#ffcc33"><div class="container lambda"><div class="container"><h1>Hoplon</h1><p>A simpler way to program the web.</p><p><a shape="rect" class="btn btn-large btn-primary" href="#/getting-started/">Get started »</a></p></div></div></div><div class="container"><div class="row"><div class="col-md-4"><h2>Clojure, everywhere.</h2><p>Write everything in Clojure and ClojureScript, clientside and
            serverside. Even the page markup is ClojureScript that is
            evaluated to produce the DOM. Pages can still be written using
            the familiar HTML syntax if desired.</p></div><div class="col-md-4"><h2>Simplicity on the client.</h2><p>Use a spreadsheet-like dataflow programming environment to manage
            client state. Develop basic content-oriented pages and complex
            thick-client applications without descending into “callback
            hell”.</p></div><div class="col-md-4"><h2>Simplicity on the server.</h2><p>Decouple business logic from HTTP-related concerns while
            satisfying complex, fine-grained authorization requirements with
            transparent, performant transfer of Clojure data between server
            and client.</p></div></div><hr><div class="row"><div class="col-md-6"><h2>Overview <small>Hoplon in a nutshell.</small></h2><p>Hoplon provides a number of libraries promoting a simpler model
            for web applications. The project can be divided into three main
            components: the HTML evaluator, the clientside state machine, and
            serverside RPC middleware. These components can be used together
            as a full stack, or individually as a part of another stack.</p><p>More concretely, Hoplon ships with a compiler for compiling
            Hoplon pages into HTML and JavaScript (implemented as a build
            task for the <a shape="rect" href="https://github.com/tailrecursion/boot" target="_blank">boot</a> build tool), ClojureScript libraries for creating
            spreadsheet-like dataflow programs and wiring them to the DOM,
            and ClojureScript and Clojure libraries for RPC interaction
            between client and server.</p><p>The source code for Hoplon is hosted on <a shape="rect" href="https://github.com/tailrecursion/hoplon" target="_blank">GitHub</a> and Maven artifacts are deployed to <a shape="rect" href="https://clojars.org/tailrecursion/hoplon" target="_blank">Clojars</a>. Contributions of code, feedback, feature requests, etc. are
            welcome. Please read the <a shape="rect" href="#/community/">Community</a> page for more information.</p><h2>Web Apps <small>Single-page applications, not documents.</small></h2><p>Web applications are not documents. Users need to be able to
            interact with them. They contain state. Through them the user
            communicates with backend systems to have some effect on the
            real world.</p><p>Hoplon web apps are organized like applications. The Hoplon
            compiler produces artifacts, not documents. These artifacts are
            equivalent to JAR files in Maven–their coordinates being the
            URL on which they're deployed. The compilation unit is the “page”,
            which is compiled to produce an HTML file–a single-page app.</p><p>Hoplon does not perform any serverside HTML rendering; it is
            completely unnecessary, even for SEO purposes. (Reload this
            page with JavaScript disabled and see how the content was
            “prerendered” at compile time.)</p><h2>HTML Evaluator <small>Page markup is a program.</small></h2><p>Web application user interfaces are specified as trees of
            nested elements in HTML markup, but this document-like
            appearance is misleading. Without JavaScript this markup cannot
            provide the dynamic behavior that web applications require.</p><p>It is at the boundary between the DOM and the JavaScript
            environment that the incidental complexities of web application
            UI development are found. There is a fundamental disconnect
            between the literal representation of the DOM (the HTML markup)
            and the dynamic environment (the JavaScript VM). The page markup
            is evaluated by the browser and the resulting DOM is then
            accessible from JavaScript, but it's a one-way linkage–there is
            no way to refer to objects created dynamically in the JavaScript
            environment from the markup. The browser's HTML evaluation model
            lacks a means of abstraction, preventing the development of new
            elements by composition.</p><p>Hoplon provides an HTML evaluator that closes the loop, unifying
            the page markup and the JavaScript environment. Page markup,
            expressed in either the standard HTML5 syntax or Clojure sexps,
            is evaluated as ClojureScript and the result becomes the DOM for
            the page. HTML tags are simply ClojureScript vars. Of course,
            Hoplon ships with all of the standard HTML5 primitives but the
            evaluation model now facilitates the use of custom compound
            elements defined in the environment, too.</p><p>Additionally, the unification of HTML and ClojureScript syntax,
            semantics, and namespace in the HTML evaluator facilitates the
            use of macros in markup.  This makes it possible to write
            powerful looping and control structures for use in the page's
            HTML markup itself, bringing the power and expressiveness of
            Lisp to HTML.</p><h2>Components <small>First-class custom DOM elements.</small></h2><p>While there is no shortage of templating systems to create
            blobs of DOM elements, there is no mechanism to create custom
            elements that are composable in any meaningful way. Consider
            the situation where a template engine binds a DOM template to
            some data and returns the filled-in DOM subtree. What happens
            when you append a child to, or set an attribute on that DOM
            element? The child gets appended to, or attribute set on the
            outermost element of the filled template, generally not what is
            required for the composition semantic.</p><p>Hoplon provides facilities for creating real, first-class
            components. That is to say, Hoplon components are first-class
            citizens in the DOM world–they are, essentially, user-defined
            custom DOM elements. They have a literal representation in the
            page markup and they implement the semantics of HTML: setting
            attributes and appending children. When a child is appended to
            a Hoplon component or an attribute is set, either in HTML markup
            or programmatically, the component's implementation is used
            instead of the built-in DOM one. In this way components can be
            built by composing simpler components and those may be used as
            a basis for even more complex components, without running into
            the limitations of template composition.</p><h2>Spreadsheets <small>Client state made simple.</small></h2><p>Remember how awesome spreadsheets are? You never think about
            state when you’re programming a spreadsheet. Instead, you focus
            on values and the formulas that define the relationships between
            them. When a new value is entered into a cell the rest of the
            spreadsheet updates itself as necessary to maintain the
            correctness of the formulas.</p><p>After a spreadsheet is set up you can link its cells to charts
            and forms to create a user interface that manages its own state,
            automatically. User input flows from forms to input cells.
            Formulas then recompute their values as necessary. These values
            then flow to charts and graphs for the user to view.</p><p>Hoplon applies this crazy, futuristic technology to frontend
            web development. Forgoing the clunky grid metaphor and names
            like <em>A1</em> and <em>B27</em>, Hoplon provides a cell
            reference type. These cells, like cells in a spreadsheet, are
            either updated directly (input cells), or automatically in
            accordance with a formula.</p><h2>Charts and Forms <small>Stateless, automatic UI.</small></h2><p>The purpose of a program's user interface is to transmit input
            from the user to the underlying state model and to present output
            derived from the underlying state model to the user for viewing.</p><p>In a web application the user interface is derived from the page
            markup. User input consists entirely of DOM events: <em>click</em>, <em>change</em>, etc. Output is presented to
            the user by manipulating the properties of DOM elements: adding
            or removing CSS classes, changing the content of text nodes,
            etc.</p><p>Hoplon provides bindings that can be used to link DOM elements
            to the underlying state model in the same way that charts and
            forms are linked to cells in a spreadsheet. Once the structure
            of the DOM and the linkages between the DOM and cells are
            defined, the user interface manages itself.</p></div><div class="col-md-6"><h2><small>Examples</small></h2><div class="list-group"><div class="list-group-item"><a shape="rect" style="display: none; "></a><h3 class="panel-title">Typical Page</h3><div><h3 class="panel-title">Typical Page</h3><hr><p>The page can be coded in either ClojureScript or HTML
                  syntax. The compiler can parse either one. It's easy to add
                  a preprocessing step to parse HAML, etc. if desired.  HTML
                  is usually more verbose and noisy than ClojureScript, so
                  most examples in this document will be using the latter
                  syntax.</p><hr><p class="text-muted">Using ClojureScript syntax:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"foo/bar.html"</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">my.lib</span> <span class="ss">:as</span> <span class="nv">lib</span><span class="p">]))</span>

<span class="p">(</span><span class="nf">defc</span> <span class="nv">clicks</span> <span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span>
    <span class="p">(</span><span class="nf">title</span> <span class="s">"Hello World"</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">link</span> <span class="ss">:rel</span> <span class="s">"stylesheet"</span> <span class="ss">:href</span> <span class="s">"css/main.css"</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">lib/heading-large</span> <span class="s">"Hello, world!"</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">p</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"You've clicked ~{clicks} times."</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">button</span> <span class="ss">:on-click</span> <span class="o">#</span><span class="p">(</span><span class="nf">swap!</span> <span class="nv">clicks</span> <span class="nv">inc</span><span class="p">)</span> <span class="s">"Click me!"</span><span class="p">)))</span>
</pre></div><p class="text-muted">Using HTML syntax:</p><div class="highlight"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/hoplon"</span><span class="nt">&gt;</span>
(page "foo/bar.html"
  (:require [my.lib :as lib]))

(defc clicks 0)
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Hello World<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/main.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;lib.heading-large&gt;</span>Hello, world!<span class="nt">&lt;/lib.heading-large&gt;</span>
<span class="nt">&lt;p&gt;&lt;text&gt;</span>You've clicked ~{clicks} times.<span class="nt">&lt;/text&gt;&lt;/p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">"{{ #(swap! clicks inc) }}"</span><span class="nt">&gt;</span>
Click me!
<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div></div></div><div class="list-group-item"><a shape="rect" class="topfix"></a><a shape="rect"></a><h3 class="panel-title">BMI Calculator</h3><div style="display: none; "><h3 class="panel-title">BMI Calculator</h3><hr><p>This is an example of a spreadsheet-like application.
                  The application's state is contained in <em>cells</em> which are wired up to the DOM. DOM events cause changes
                  to the underlying cells and formula cells in turn cause
                  changes to the DOM.</p><hr><p class="text-muted">The demo:</p><div class="panel panel-default"><div class="panel-body"><div><form enctype="application/x-www-form-urlencoded" method="get"><div class="form-group"><label>Height (180 cm)</label><input type="range" class="form-control" id="bmi-ht" min="0" max="250"></div><div class="form-group"><label>Weight (80.0 kg)</label><input type="range" class="form-control" id="bmi-wt" min="0" max="1500"></div><div class="form-group"><label>BMI 24.7 (normal)</label><input readonly="readonly" type="range" class="form-control" min="0" max="500" style="background-color: inherit; "></div></form></div></div></div><p class="text-muted">The cells:</p><div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">height</span> <span class="p">(</span><span class="nf">cell</span> <span class="mi">180</span><span class="p">))</span> <span class="c1">; height in cm</span>
<span class="p">(</span><span class="k">def </span><span class="nv">weight</span> <span class="p">(</span><span class="nf">cell</span>  <span class="mi">80</span><span class="p">))</span> <span class="c1">; weight in kg</span>

<span class="p">(</span><span class="k">def </span><span class="nv">bmi</span> <span class="c1">; formula: [bmi, description, color]</span>
  <span class="p">(</span><span class="nf">cell=</span>
    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">htm</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">height</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">; height in meters</span>
          <span class="nv">bmi</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">weight</span> <span class="p">(</span><span class="nb">* </span><span class="nv">htm</span> <span class="nv">htm</span><span class="p">))]</span>
      <span class="p">(</span><span class="nf">cond</span>
        <span class="p">(</span><span class="nb">&lt; </span><span class="nv">bmi</span> <span class="mf">18.5</span><span class="p">)</span> <span class="p">[</span><span class="nv">bmi</span> <span class="s">"underweight"</span>  <span class="s">"orange"</span><span class="p">]</span>
        <span class="p">(</span><span class="nb">&lt; </span><span class="nv">bmi</span> <span class="mf">25.0</span><span class="p">)</span> <span class="p">[</span><span class="nv">bmi</span> <span class="s">"normal"</span>      <span class="s">"inherit"</span><span class="p">]</span>
        <span class="p">(</span><span class="nb">&lt; </span><span class="nv">bmi</span> <span class="mf">30.0</span><span class="p">)</span> <span class="p">[</span><span class="nv">bmi</span> <span class="s">"overweight"</span>   <span class="s">"orange"</span><span class="p">]</span>
        <span class="ss">:else</span>        <span class="p">[</span><span class="nv">bmi</span> <span class="s">"obese"</span>           <span class="s">"red"</span><span class="p">]))))</span>
</pre></div><p class="text-muted">The user interface:</p><div class="highlight"><pre><span class="c1">;; Some details related to &lt;input type="range"&gt;</span>
<span class="c1">;; have been omitted for clarity.</span>
<span class="p">(</span><span class="nf">form</span>
  <span class="p">(</span><span class="nf">label</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"Height (~{height} cm)"</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">input</span>
    <span class="ss">:id</span> <span class="s">"bmi-h"</span>
    <span class="ss">:value</span> <span class="err">@</span><span class="nv">height</span>
    <span class="ss">:on-input</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">height</span> <span class="p">(</span><span class="nf">val-id</span> <span class="s">"bmi-h"</span><span class="p">)))</span>

  <span class="p">(</span><span class="nf">label</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"Weight (~{weight} kg)"</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">input</span>
    <span class="ss">:id</span> <span class="s">"bmi-w"</span>
    <span class="ss">:value</span> <span class="err">@</span><span class="nv">weight</span>
    <span class="ss">:on-input</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">weight</span> <span class="p">(</span><span class="nf">val-id</span> <span class="s">"bmi-w"</span><span class="p">)))</span>

  <span class="p">(</span><span class="nf">label</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"BMI ~(first bmi) (~(second bmi))"</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">input</span>
    <span class="ss">:do-value</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">(</span><span class="nb">first </span><span class="nv">bmi</span><span class="p">))</span>
    <span class="ss">:do-css</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">{</span><span class="ss">:background-color</span> <span class="p">(</span><span class="nb">nth </span><span class="nv">bmi</span> <span class="mi">2</span><span class="p">)})))</span>
</pre></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Architecture</h3></div><div class="panel-body"><div><ul class="nav nav-tabs"><li class="active"><a shape="rect" href="javascript:void(0)"><span>Fig 1</span></a></li><li><a shape="rect" href="javascript:void(0)"><span>Fig 2</span></a></li></ul><div class="tab-content"><img class="tab-pane active" width="523px" src="img/arch-full.png"><img class="tab-pane" width="523px" src="img/arch-client.jpg"></div></div></div></div></div></div><hr><footer style="padding:30px 0px;"><div style="text-align:center;">Copyright © Alan Dipert and Micha Niskin. All rights reserved.</div></footer></div></div><div class="container" style="display: none; "><div class="row"><div class="col-md-4"><div class="panel panel-default affix hidden-xs hidden-sm"><div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div><div class="panel-body"><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li><a shape="rect" style="cursor:pointer;">Task 1: Create a new project.</a></li><li><a shape="rect" style="cursor:pointer;">Task 2: Compile the project.</a></li><li><a shape="rect" style="cursor:pointer;">Task 3: Add a counter.</a></li><li><a shape="rect" style="cursor:pointer;">Task 4: A simple calculator.</a></li><li><a shape="rect" style="cursor:pointer;">Task 5: Using the looping macro.</a></li><li><a shape="rect" style="cursor:pointer;">Task 6: Add static resources.</a></li><li><a shape="rect" style="cursor:pointer;">Task 7: Create a “tabs” abstraction.</a></li><li><a shape="rect" style="cursor:pointer;">Castra</a></li><li><a shape="rect" style="cursor:pointer;">Castra 1: Create a Castra project</a></li><li><a shape="rect" style="cursor:pointer;">Castra 2: Compile the project.</a></li><li><a shape="rect" style="cursor:pointer;">Castra 3: Modifying a Castra endpoint</a></li><li><a shape="rect" style="cursor:pointer;">Castra 4: Update the client - Part 1</a></li><li><a shape="rect" style="cursor:pointer;">Castra 5: Update the client - Part 2</a></li><li><a shape="rect" style="cursor:pointer;">Learn more</a></li></ul></div></div></div></div></div><div class="col-md-8"><a shape="rect" class="topfix"></a><h1>Getting Started<br clear="none"><small>Build a Hoplon application from scratch.</small></h1><hr><div class="panel panel-default hidden-md hidden-lg"><div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div><div class="panel-body"><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li><a shape="rect" style="cursor:pointer;">Task 1: Create a new project.</a></li><li><a shape="rect" style="cursor:pointer;">Task 2: Compile the project.</a></li><li><a shape="rect" style="cursor:pointer;">Task 3: Add a counter.</a></li><li><a shape="rect" style="cursor:pointer;">Task 4: A simple calculator.</a></li><li><a shape="rect" style="cursor:pointer;">Task 5: Using the looping macro.</a></li><li><a shape="rect" style="cursor:pointer;">Task 6: Add static resources.</a></li><li><a shape="rect" style="cursor:pointer;">Task 7: Create a “tabs” abstraction.</a></li><li><a shape="rect" style="cursor:pointer;">Castra</a></li><li><a shape="rect" style="cursor:pointer;">Castra 1: Create a Castra project</a></li><li><a shape="rect" style="cursor:pointer;">Castra 2: Compile the project.</a></li><li><a shape="rect" style="cursor:pointer;">Castra 3: Modifying a Castra endpoint</a></li><li><a shape="rect" style="cursor:pointer;">Castra 4: Update the client - Part 1</a></li><li><a shape="rect" style="cursor:pointer;">Castra 5: Update the client - Part 2</a></li><li><a shape="rect" style="cursor:pointer;">Learn more</a></li></ul></div></div></div></div><p>This article will demonstrate how to build Hoplon applications.
        A simple application will be developed incrementally. New features
        will be added at each step, showing how different parts of Hoplon
        are used.</p><br clear="none"><div class="panel panel-default panel-info"><div class="panel-heading"><h3 class="panel-title">System Requirements (Compiler)</h3></div><div class="panel-body"><ul><li>Java 6+</li><li>Leiningen 2</li><li>The <a shape="rect" href="https://github.com/tailrecursion/boot" target="_blank">boot</a> build tool.</li></ul></div></div><div class="panel panel-default panel-info"><div class="panel-heading"><h3 class="panel-title">Browser Compatibility</h3></div><div class="panel-body"><ul><li>Chrome</li><li>Safari</li><li>Firefox</li><li>Internet Explorer 8+</li></ul></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 1: Create a new project.</h3></div><div class="panel-body"><p>The Hoplon Leiningen template can be used to create a simple
          “hello world” project:</p><div class="highlight"><pre><span class="nv">$ </span>lein new hoplon my-project
</pre></div><p>The directory of a new Hoplon project is:</p><pre><code>.
├── build.boot
├── README.md
├── assets
│   └── css
│       └── main.css
└── src
└── index.cljs.hl</code></pre><p>If lein complains that it 'Could not find template hoplon on
          the classpath.', it may mean that you need a more recent version
          of lein. The command <code>lein upgrade</code> may help.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 2: Compile the project.</h3></div><div class="panel-body"><p>In another terminal do the following in the project directory:</p><div class="highlight"><pre><span class="nv">$ </span>boot development
</pre></div><p>This starts the Hoplon compiler in “development” mode – source
          directories are monitored for changes and recompiled when
          necessary. When it finished compiling the project directory
          should look like this:</p><pre><code>.
├── README.md
├── build.boot
├── assets
│   └── css
│       └── main.css
├── resources
│   └── public
│       ├── main.js
│       ├── index.html
│       └── css
│           └── main.css
└── src
└── index.cljs.hl</code></pre><p>The files on <code>resources/public</code> are generated by the
          compiler. You should not edit these files as they are rewritten
          everytime the source is compiled.</p><p>Open <code>resources/public/index.html</code> in a browser and
          enjoy a friendly greeting.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 3: Add a counter.</h3></div><div class="panel-body"><p>Now we add a counter to the page that will keep track of how
          many times a button was clicked. To do this we add an input
          cell containing the click count to the environment, and link
          it to UI elements for input and output interactions with the
          user. Input will be click events on the button. Output will
          be the contents of a text node displaying the current count.</p><p>Button click events are wired up to the input cell with the <code>:on-click</code> attribute. The <code>text</code> macro does
          some string interpolation and wires the input cell to the value
          of a text node such that it’s updated whenever the cell’s value
          changes.</p><p>Modify the <code>index.cljs.hl</code> page such that it contains
          the following:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defc</span> <span class="nv">clicks</span> <span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">text</span> <span class="s">"Clicks so far: ~{clicks} "</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">button</span> <span class="ss">:on-click</span> <span class="o">#</span><span class="p">(</span><span class="nf">swap!</span> <span class="nv">clicks</span> <span class="nv">inc</span><span class="p">)</span> <span class="s">"click me!"</span><span class="p">)))</span>
</pre></div><p>If the compiler is still running in another terminal the
          application will be recompiled. Reload the page and click the
          button a few times. You should see something like this:</p><div class="panel panel-default"><div class="panel-body">Clicks so far: 0 <button type="submit">click me!</button></div></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 4: A simple calculator.</h3></div><div class="panel-body"><p>The next task is to build a simple calculator that can add,
          subtract, multiply, or divide two integers. Modify the <code>index.cljs.hl</code> file to contain the following:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span>
  <span class="p">(</span><span class="ss">:refer-clojure</span> <span class="ss">:exclude</span> <span class="p">[</span><span class="nv">int</span><span class="p">]))</span>

<span class="p">(</span><span class="k">def </span><span class="nb">int </span><span class="nv">js/parseInt</span><span class="p">)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">ops</span> <span class="p">{</span><span class="s">"+"</span> <span class="nb">+ </span><span class="s">"-"</span> <span class="nb">- </span><span class="s">"*"</span> <span class="nb">* </span><span class="s">"/"</span> <span class="nv">/</span><span class="p">})</span>

<span class="p">(</span><span class="nf">defc</span>  <span class="nv">x</span>      <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defc</span>  <span class="nv">y</span>      <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defc</span>  <span class="nv">op</span>     <span class="nv">+</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defc=</span> <span class="nv">result</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">input</span>
      <span class="ss">:id</span> <span class="s">"x"</span>
      <span class="ss">:type</span> <span class="s">"text"</span>
      <span class="ss">:value</span> <span class="s">"0"</span>
      <span class="ss">:on-change</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nf">val-id</span> <span class="s">"x"</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">select</span>
      <span class="ss">:id</span> <span class="s">"op"</span>
      <span class="ss">:on-change</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">op</span> <span class="p">(</span><span class="nf">ops</span> <span class="p">(</span><span class="nf">val-id</span> <span class="s">"op"</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">option</span> <span class="ss">:value</span> <span class="s">"+"</span> <span class="ss">:selected</span> <span class="nv">true</span> <span class="s">"+"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">option</span> <span class="ss">:value</span> <span class="s">"-"</span> <span class="s">"-"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">option</span> <span class="ss">:value</span> <span class="s">"*"</span> <span class="s">"*"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">option</span> <span class="ss">:value</span> <span class="s">"/"</span> <span class="s">"/"</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">input</span>
      <span class="ss">:id</span> <span class="s">"y"</span>
      <span class="ss">:type</span> <span class="s">"text"</span>
      <span class="ss">:value</span> <span class="s">"0"</span>
      <span class="ss">:on-change</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nf">val-id</span> <span class="s">"y"</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">text</span> <span class="s">" = ~{result}"</span><span class="p">)))</span>
</pre></div><p>Compile and reload the page. You should see something like this:</p><div class="panel panel-default"><div class="panel-body"><input type="text" id="calc-x"><select id="calc-op" style="margin-left:15px;margin-right:15px;"><option selected="selected" value="+">+</option><option value="-">-</option><option value="*">*</option><option value="/">/</option></select><input type="text" id="calc-y"> = 0</div></div><p>Notice how the presentation (the page markup) is effectively
          decoupled from the application state (the cells). The
          four cells that contain the application's state could be
          defined in a different namespace, distributed in a jar
          file, deployed to a Maven repository, and used in a
          number of different pages. They form a well-defined API
          for the frontend developer to hook into when developing
          the page markup. This decoupling of presentation and
          state is a key component of the Hoplon model.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 5: Using the looping macro.</h3></div><div class="panel-body"><p>Most applications have sequential collections that need to be
          displayed to the user in some kind of template. Hoplon provides
          the <code>loop-tpl</code> macro that can be used in the page
          markup to iterate over the collection.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defc</span> <span class="nv">things</span> <span class="p">[</span><span class="s">"one"</span> <span class="s">"two"</span> <span class="s">"three"</span><span class="p">])</span>

<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">ul</span>
      <span class="p">(</span><span class="nf">loop-tpl</span> <span class="ss">:bindings</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">things</span><span class="p">]</span>
        <span class="p">(</span><span class="nf">li</span> <span class="err">@</span><span class="nv">x</span><span class="p">)))))</span>
</pre></div><p>Compile and reload the page. You should see something like this:</p><div class="panel panel-default"><div class="panel-body"><ul><li>one</li><li>two</li><li>three</li></ul></div></div><p>Note how <code>loop-tpl</code> iterates over the <code>things</code> cell, binding each item to <code>x</code>, in turn. However,
          notice that <code>x</code> needs to be dereferenced to be used in
          the template. This is because <code>x</code> is actually bound to
          a cell that always contains the nth item of the collection cell
          and not to the item itself.</p><p>Here is a more interesting example that uses destructuring in
          the <code>:bindings</code> attribute:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">upper-case</span> <span class="nv">lower-case</span><span class="p">]]))</span>
<span class="c1">;; State machine private</span>
<span class="p">(</span><span class="nf">defc</span>  <span class="nv">uc?</span>    <span class="nv">false</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defc</span>  <span class="nv">things</span> <span class="p">[{</span><span class="ss">:text</span> <span class="s">"one"</span><span class="p">}</span> <span class="p">{</span><span class="ss">:text</span> <span class="s">"two"</span><span class="p">}</span> <span class="p">{</span><span class="ss">:text</span> <span class="s">"three"</span><span class="p">}])</span>
<span class="p">(</span><span class="nf">defc=</span> <span class="nv">case</span>   <span class="p">(</span><span class="k">if </span><span class="nv">uc?</span> <span class="nv">upper-case</span> <span class="nv">lower-case</span><span class="p">))</span>

<span class="c1">;; State machine public API</span>
<span class="p">(</span><span class="nf">defc=</span> <span class="nv">state</span>  <span class="p">(</span><span class="nf">mapv</span> <span class="o">#</span><span class="p">(</span><span class="nf">update-in</span> <span class="nv">%</span> <span class="p">[</span><span class="ss">:text</span><span class="p">]</span> <span class="nv">case</span><span class="p">)</span> <span class="nv">things</span><span class="p">))</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">toggle-case!</span> <span class="p">[</span><span class="nv">_</span><span class="p">]</span> <span class="p">(</span><span class="nf">swap!</span> <span class="nv">uc?</span> <span class="nv">not</span><span class="p">))</span>

<span class="c1">;; Presentation (uses public API)</span>
<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">ul</span>
      <span class="p">(</span><span class="nf">loop-tpl</span> <span class="ss">:bindings</span> <span class="p">[{</span><span class="nv">x</span> <span class="ss">:text</span><span class="p">}</span> <span class="nv">state</span><span class="p">]</span>
        <span class="p">(</span><span class="nf">li</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"~{x}"</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">button</span> <span class="ss">:on-click</span> <span class="nv">toggle-case!</span> <span class="s">"toggle case"</span><span class="p">)))</span>
</pre></div><p>Now when you reload the page you should see something like this:</p><div class="panel panel-default"><div class="panel-body"><ul><li>one</li><li>two</li><li>three</li></ul><button type="submit">toggle case</button></div></div><p>Notice the organization of the public API for the page’s
          underlying state machine: it consists of read-only formula cells
          and state transition functions that modify the underlying input
          cells as a side effect. This is known as the <a shape="rect" href="http://martinfowler.com/bliki/CQRS.html" target="_blank">CQRS pattern</a> and forms the
          basic architecture of a Hoplon single-page app.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 6: Add static resources.</h3></div><div class="panel-body"><p>Now it’s time to add some static resources to the project. For
          example, adding the <a shape="rect" href="http://getbootstrap.com/getting-started/" target="_blank">Twitter Bootstrap</a> CSS stylesheets might help to get things looking fancy.
          If you look in <code>build.boot</code> file, you'll see that it
          contains the following:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">add-sync!</span> <span class="p">(</span><span class="nf">get-env</span> <span class="ss">:out-path</span><span class="p">)</span> <span class="o">#</span><span class="p">{</span><span class="s">"assets"</span><span class="p">})</span>
</pre></div><p>This defines the location of static assets in your project.
          Download Bootstrap and copy the <code>bootstrap.css</code> file
          into the <code>assets/css</code> directory. The project directory
          should be organized something like this now:</p><pre><code>.
├── build.boot
├── assets
│   └── css
│       ├── bootstrap.css
│       └── main.css
├── resources
│   └── public
│       ├── index.html
│       └── main.js
└── src
└── index.cljs.hl</code></pre><p>Restart the compiler and see how the <code>css</code> directory
          is copied over into the output directory automatically (and
          whenever anything in there changes).</p><p>In order to use bootstrap, the html head tag must contain a
          link to the bootstrap css file. Change <code>(head)</code> to:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">head</span>
  <span class="p">(</span><span class="nf">link</span> <span class="ss">:href</span> <span class="s">"css/bootstrap.css"</span> <span class="ss">:rel</span> <span class="s">"stylesheet"</span><span class="p">))</span>
</pre></div><p>This is enough to bring in the bootstrap look and feel.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Task 7: Create a “tabs” abstraction.</h3></div><div class="panel-body"><p>This task demonstrates how to create a UI kit library that can be
          used in multiple pages. UI kits contain custom tags representing
          user interface abstractions. One commonly used abstraction is the
          “tabs” metaphor that everyone is familiar with.</p><p>The new UI library should live in a separate namespace and
          contain custom DOM elements to use in the application pages.
          Create a new Hoplon source file, <code>src/ui/tabs.cljs.hl</code> with the following contents:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">ui.tabs</span><span class="p">)</span>

<span class="p">(</span><span class="nf">defelem</span> <span class="nv">active</span>
  <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">state</span><span class="p">]}</span> <span class="p">[</span><span class="nv">elem</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">elem</span> <span class="ss">:do-class</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">{</span><span class="ss">:active</span> <span class="nv">state</span><span class="p">})))</span>

<span class="p">(</span><span class="nf">defelem</span> <span class="nv">trigger</span>
  <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">state</span> <span class="nv">tab</span><span class="p">]}</span> <span class="p">[</span><span class="nv">elem</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">active</span> <span class="ss">:state</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">(</span><span class="nb">= </span><span class="nv">state</span> <span class="nv">tab</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">elem</span> <span class="ss">:on-click</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">state</span> <span class="nv">tab</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">defelem</span> <span class="nv">content</span>
  <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">state</span> <span class="nv">tab</span><span class="p">]}</span> <span class="p">[</span><span class="nv">elem</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">active</span> <span class="ss">:state</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">(</span><span class="nb">= </span><span class="nv">state</span> <span class="nv">tab</span><span class="p">))</span> <span class="nv">elem</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defelem</span> <span class="nv">tabs</span>
  <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">state</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">attr</span> <span class="ss">:or</span> <span class="p">{</span><span class="nv">state</span> <span class="p">(</span><span class="nf">cell</span> <span class="mi">0</span><span class="p">)}}</span> <span class="nv">kids</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[[</span><span class="nv">trigs</span> <span class="nv">conts</span><span class="p">]</span> <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">kids</span> <span class="p">(</span><span class="nf">partition</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply map </span><span class="nv">list</span><span class="p">))</span>
        <span class="nv">a-void</span> <span class="o">#</span><span class="p">(</span><span class="nf">a</span> <span class="ss">:href</span> <span class="s">"javascript:void(0)"</span> <span class="nv">%</span><span class="p">)</span>
        <span class="nv">mktrig</span> <span class="o">#</span><span class="p">(</span><span class="nf">trigger</span> <span class="ss">:state</span> <span class="nv">state</span> <span class="ss">:tab</span> <span class="nv">%1</span> <span class="p">(</span><span class="nf">li</span> <span class="p">(</span><span class="nf">a-void</span> <span class="nv">%2</span><span class="p">)))</span>
        <span class="nv">mkcont</span> <span class="o">#</span><span class="p">(</span><span class="nf">content</span> <span class="ss">:state</span> <span class="nv">state</span> <span class="ss">:tab</span> <span class="nv">%1</span> <span class="p">(</span><span class="nf">%2</span> <span class="ss">:class</span> <span class="s">"tab-pane"</span><span class="p">))]</span>
    <span class="p">(</span><span class="nf">div</span> <span class="p">(</span><span class="nb">dissoc </span><span class="nv">attr</span> <span class="ss">:state</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">ul</span> <span class="ss">:class</span> <span class="s">"nav nav-tabs"</span> <span class="p">(</span><span class="nf">map-indexed</span> <span class="nv">mktrig</span> <span class="nv">trigs</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">div</span> <span class="ss">:class</span> <span class="s">"tab-content"</span> <span class="p">(</span><span class="nf">map-indexed</span> <span class="nv">mkcont</span> <span class="nv">conts</span><span class="p">)))))</span>
</pre></div><p>The <code>defelem</code> macro defines a function whose arguments
          are “normalized” for the HTML markup semantic. It takes a vector
          of bindings and a number of body expressions. The bindings vector
          should bind the attribute map as the first argument and a sequence
          of children as the second. This removes the need to explicitly
          parse the arguments when the function is called in the page markup
          with key/value arguments as attributes, etc.</p><p>Notice how there is no need to <code>:refer</code> any of the
          Hoplon or Javelin vars in the namespace declaration. The Hoplon
          compiler does that automatically so you can just use <code>defelem</code>, <code>div</code>, <code>span</code>, etc. in
          the namespace without explicitly requiring them.</p><p>Then modify <code>index.cljs.hl</code> such that it looks like
          this, using the newly created <code>tabs</code> custom tag:</p><div><ul class="nav nav-tabs"><li class="active"><a shape="rect" href="javascript:void(0)">index.cljs.hl</a></li><li><a shape="rect" href="javascript:void(0)">index.html.hl</a></li></ul><div class="tab-content"><div class="highlight tab-pane active"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">ui.tabs</span> <span class="ss">:as</span> <span class="nv">tabs</span><span class="p">]))</span>

<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span>
    <span class="p">(</span><span class="nf">link</span> <span class="ss">:rel</span> <span class="s">"stylesheet"</span> <span class="ss">:href</span> <span class="s">"css/bootstrap.css"</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">tabs/tabs</span>
      <span class="p">(</span><span class="nf">span</span> <span class="s">"Zero"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">div</span>
        <span class="p">(</span><span class="nf">h4</span> <span class="s">"Foo"</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">p</span> <span class="s">"Content for tab 0."</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">span</span> <span class="s">"One"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">div</span>
        <span class="p">(</span><span class="nf">h4</span> <span class="s">"Bar"</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">p</span> <span class="s">"Content for tab 1."</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">span</span> <span class="s">"Two"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">div</span>
        <span class="p">(</span><span class="nf">h4</span> <span class="s">"Baz"</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">p</span> <span class="s">"Content for tab 2."</span><span class="p">)))))</span>
</pre></div><div class="highlight tab-pane"><pre><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/hoplon"</span><span class="nt">&gt;</span>
  (page "index.html"
    (:require [ui.tabs :as tabs]))
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/bootstrap.css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;tabs.tabs&gt;</span>
      <span class="nt">&lt;span&gt;</span>Zero<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;h4&gt;</span>Foo<span class="nt">&lt;/h4&gt;</span>
        <span class="nt">&lt;p&gt;</span>Content for tab 0.<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;span&gt;</span>One<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;h4&gt;</span>Bar<span class="nt">&lt;/h4&gt;</span>
        <span class="nt">&lt;p&gt;</span>Content for tab 1.<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;span&gt;</span>Two<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;h4&gt;</span>Baz<span class="nt">&lt;/h4&gt;</span>
        <span class="nt">&lt;p&gt;</span>Content for tab 2.<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/tabs.tabs&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div></div></div><p>Compile and reload the page. You should see something like this:</p><div class="panel panel-default"><div class="panel-body"><div><ul class="nav nav-tabs"><li class="active"><a shape="rect" href="javascript:void(0)"><span>Zero</span></a></li><li><a shape="rect" href="javascript:void(0)"><span>One</span></a></li><li><a shape="rect" href="javascript:void(0)"><span>Two</span></a></li></ul><div class="tab-content"><div class="tab-pane active"><h4>Foo</h4><p>Content for tab 0.</p></div><div class="tab-pane"><h4>Bar</h4><p>Content for tab 1.</p></div><div class="tab-pane"><h4>Baz</h4><p>Content for tab 2.</p></div></div></div></div></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra</h3></div><div class="panel-body"><p>The next tasks will help you to getting stated with Castra, the
          RPC library that comes with Hoplon.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra 1: Create a Castra project</h3></div><div class="panel-body"><p>The hoplon-castra Leiningen template can be used to create a simple
          “hello world” project:</p><div class="highlight"><pre><span class="nv">$ </span>lein new hoplon-castra my-project
</pre></div><p>The directory of a new hoplon-castra project is:</p><pre><code>.
├── assets
│   └── css
│       └── main.css
├── build.boot
├── README.md
└── src
├── clj
│   └── my_project
│       ├── api.clj
│       └── core.clj
├── cljs
│   └── my_project
│       └── rpc.cljs
└── hl
└── my_project
└── index.cljs.hl</code></pre><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra 2: Compile the project.</h3></div><div class="panel-body"><p>In another terminal do the following in the project directory:</p><div class="highlight"><pre><span class="nv">$ </span>boot development
</pre></div><p>This starts the Hoplon compiler in “development” mode — source
          directories are monitored for changes and recompiled when
          necessary. It will also start a development web server on port 8000.</p><p>Go to <a shape="rect" href="http://localhost:8000" target="_blank">http://localhost:8000</a> in a browser and enjoy a friendly greeting. Notice the random
          numbers. They are generated on the server and the client uses Castra
          to get them.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra 3: Modifying a Castra endpoint</h3></div><div class="panel-body"><p>Castra endpoints are functions created with <code>defrpc</code> from the <code>tailrecursion.castra</code> namespace.</p><p>Modify the <code>api.clj</code> file such that it contains the
          following:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.api</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">tailrecursion.castra</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defrpc</span><span class="p">]]))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">counter</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">0</span><span class="p">))</span>

<span class="p">(</span><span class="nf">defrpc</span> <span class="nv">get-state</span> <span class="p">[]</span>
  <span class="p">{</span><span class="ss">:rpc/query</span> <span class="p">[{</span><span class="ss">:random</span> <span class="p">(</span><span class="nb">rand-int </span><span class="mi">100</span><span class="p">)</span>
                <span class="ss">:counter</span> <span class="err">@</span><span class="nv">counter</span><span class="p">}]}</span>
  <span class="p">(</span><span class="nf">swap!</span> <span class="nv">counter</span> <span class="nv">inc</span><span class="p">))</span>
</pre></div><p>The <code>defrpc</code>from Castra takes a special map that works
          in a manner like the pre- and postconditions in Clojure functions.
          There are two special keys: <code>:rpc/pre</code> and <code>:rpc/query</code>. When <code>:rpc/query</code> is present, the
          body of the function is evaluated only for side effects — in this
          case, updating the counter. The response
          will be the content of <code>:rpc/query</code>. Like Clojure's pre-
          and postconditions, the expression needs to be inside a vector, but
          the vector is not part of the return value, only its content.</p><p>Now the endpoint is returning a map with two keys: <code>:random</code> and <code>:counter</code>. Boot will autoreload
          the server side files when you save them if you are using the <code>boot development</code> task.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra 4: Update the client - Part 1</h3></div><div class="panel-body"><p>Now we need to update the client. First change the <code>rpc.cljs</code> file to make it like this:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.rpc</span>
  <span class="p">(</span><span class="ss">:require-macros</span>
   <span class="p">[</span><span class="nv">tailrecursion.javelin</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defc</span> <span class="nv">defc=</span><span class="p">]])</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">tailrecursion.javelin</span><span class="p">]</span>
   <span class="p">[</span><span class="nv">tailrecursion.castra</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">mkremote</span><span class="p">]]))</span>

<span class="p">(</span><span class="nf">defc</span> <span class="nv">state</span> <span class="p">{</span><span class="ss">:random</span> <span class="nv">nil</span><span class="p">})</span>
<span class="p">(</span><span class="nf">defc</span> <span class="nv">error</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defc</span> <span class="nv">loading</span> <span class="p">[])</span>

<span class="p">(</span><span class="nf">defc=</span> <span class="nv">random-number</span> <span class="p">(</span><span class="nb">get </span><span class="nv">state</span> <span class="ss">:random</span><span class="p">))</span>
<span class="p">(</span><span class="nf">defc=</span> <span class="nv">counter</span> <span class="p">(</span><span class="nb">get </span><span class="nv">state</span> <span class="ss">:counter</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">get-state</span>
  <span class="p">(</span><span class="nf">mkremote</span> <span class="ss">'my-project.api/get-state</span> <span class="nv">state</span> <span class="nv">error</span> <span class="nv">loading</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">init</span> <span class="p">[]</span>
  <span class="p">(</span><span class="nf">get-state</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">js/setInterval</span> <span class="nv">get-state</span> <span class="mi">1000</span><span class="p">))</span>
</pre></div><p>This is the file that makes the communication with the server.
          It calls functions on the server like if it was just running the
          function on the client. But it really is sending a request to
          the server that send a json reponse and this response is parsed
          on the client.</p><p>There is only one new line where we define a formula cell called <code>counter</code>. It will update everytime the state is updated.
          Next we will change the page so we can see the counter.</p><p>Also take a look at the <code>mkremote</code>function. You call
          it with a quoted namespaced function and three cells: one for the
          state, one for errors and one to indicate a call in progress. So,
          if the function call succeeds the state is updated. If it errors,
          the error cell is updated. And while a call is in progress the
          loading cell will not be empty.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra 5: Update the client - Part 2</h3></div><div class="panel-body"><p>Change the <code>index.cljs.hl</code> file:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">my-project.rpc</span> <span class="ss">:as</span> <span class="nv">rpc</span><span class="p">]))</span>

<span class="p">(</span><span class="nf">rpc/init</span><span class="p">)</span>

<span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span>
    <span class="p">(</span><span class="nf">link</span> <span class="ss">:rel</span> <span class="s">"stylesheet"</span> <span class="ss">:type</span> <span class="s">"text/css"</span> <span class="ss">:href</span> <span class="s">"css/main.css"</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">h1</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"Hello, Hoplon and Castra! ~{rpc/random-number}"</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">p</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"Look! It's a counter: ~{rpc/counter}"</span><span class="p">))))</span>
</pre></div><p>Here we added a <code>p</code> tag with a <code>text</code>macro
          that will update everytime the cell updates. Reload the page and
          you will see the random numbers and your new counter.
          Congratulations!</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Learn more</h3></div><div class="panel-body"><p>You take a look at some documentation on the <a shape="rect" href="#/docs/">docs section</a> and there are some example
          projects on <a shape="rect" href="https://github.com/tailrecursion/hoplon-demos">Hoplon demos</a>. There
          are also some tutorials on the <a shape="rect" href="#/talks/">talking Hoplon section</a></p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><hr><footer style="padding:30px 0px;"><div style="text-align:center;">Copyright © Alan Dipert and Micha Niskin. All rights reserved.</div></footer></div></div></div><div class="container" style="display: none; "><div class="row"><div class="col-md-4"><div class="panel panel-default affix hidden-xs hidden-sm"><div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div><div class="panel-body"><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li><a shape="rect" style="cursor:pointer;">Creating a Hoplon project</a></li><li><a shape="rect" style="cursor:pointer;">Boot</a></li><li><a shape="rect" style="cursor:pointer;">Boot: Options</a></li><li><a shape="rect" style="cursor:pointer;">Boot: Configuration</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Source Files</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Page Anatomy</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: ClojureScript Markup Syntax</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Reader Support For Multiline Strings</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Making the DOM Dynamic</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: External JS Libs And Extern Files</a></li><li><a shape="rect" style="cursor:pointer;">Javelin</a></li><li><a shape="rect" style="cursor:pointer;">Castra</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Creating a project</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Server side rpc</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Server configuration</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - mkremote</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - state cell</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - error cell</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - loading cell</a></li></ul></div></div></div></div></div><div class="col-md-8"><a shape="rect" class="topfix"></a><h1>Docs<br clear="none"><small>Basic Hoplon docs.</small></h1><hr><div class="panel panel-default hidden-md hidden-lg"><div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div><div class="panel-body"><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li><a shape="rect" style="cursor:pointer;">Creating a Hoplon project</a></li><li><a shape="rect" style="cursor:pointer;">Boot</a></li><li><a shape="rect" style="cursor:pointer;">Boot: Options</a></li><li><a shape="rect" style="cursor:pointer;">Boot: Configuration</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Source Files</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Page Anatomy</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: ClojureScript Markup Syntax</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Reader Support For Multiline Strings</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: Making the DOM Dynamic</a></li><li><a shape="rect" style="cursor:pointer;">Hoplon: External JS Libs And Extern Files</a></li><li><a shape="rect" style="cursor:pointer;">Javelin</a></li><li><a shape="rect" style="cursor:pointer;">Castra</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Creating a project</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Server side rpc</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Server configuration</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - mkremote</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - state cell</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - error cell</a></li><li><a shape="rect" style="cursor:pointer;">Castra: Client side - loading cell</a></li></ul></div></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Creating a Hoplon project</h3></div><div class="panel-body"><p>To create a new Hoplon project you can use <code>lein</code>:</p><div class="highlight"><pre><span class="nv">$ </span>lein new hoplon my-project
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Boot</h3></div><div class="panel-body"><p>Boot is a build tool used for Hoplon projects. It's also other
          things, but here we are interested in using it with a Hoplon
          project. There is more documentation at the <a shape="rect" href="https://github.com/tailrecursion/boot">Boot project page</a>, but the information
          below is enough for most Hoplon related purposes.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Boot: Options</h3></div><div class="panel-body"><p>Hoplon source files are compiled by the Hoplon compiler. The
          easiest way to do this is to use the <code>hoplon</code> boot
          task. Options to boot tasks can be specified by wrapping the
          task name and arguments in a vector. (Boot reads in the command
          line arguments as an EDN string.) The <code>hoplon</code> task
          takes a single command line argument – a map of key/value options.</p><p>The options map may include options to be passed to the
          ClojureScript compiler (<code>:optimizations</code>, <code>:source-map</code>, etc.). Setting the <code>:prerender</code> key to false will disable the “prerendering” of
          DOM content in <tt>phantomjs(1)</tt>, which speeds up the
          compilation process at the expense of SEO (handy when developing
          but probably not ideal for production builds).</p><p>A typical development build invocation could look something like
          this:</p><div class="highlight"><pre><span class="nv">$ </span>boot watch <span class="o">[</span>hoplon <span class="o">{</span>:prerender <span class="nb">false</span> :pretty-print <span class="nb">true</span><span class="o">}]</span>
</pre></div><p>Production builds could look something like this:</p><div class="highlight"><pre><span class="nv">$ </span>boot <span class="o">[</span>hoplon <span class="o">{</span>:optimizations :advanced<span class="o">}]</span>
</pre></div><p>Command line arguments can be specified in the project <code>build.boot</code> file as their own tasks using <code>deftask</code>. The above examples are already in the
          generated <code>build.boot</code>, as <code>development</code> and <code>production</code>. We will see them later with more detail.</p><div><p>Here are some useful boot commands:</p></div><div class="highlight"><pre><span class="c"># display list of available tasks</span>
<span class="nv">$ </span>boot <span class="nb">help</span>

<span class="c"># build for development</span>
<span class="nv">$ </span>boot development

<span class="c"># build for production</span>
<span class="nv">$ </span>boot production
</pre></div><p>Options can be passed to the JVM by setting the <code>JVM_OPTS</code> environment variable. For example, JVM heap space can be set to
          1G like this:</p><div class="highlight"><pre><span class="nv">$ JVM_OPTS</span><span class="o">=</span><span class="s2">"-Xmx1g"</span> boot watch hoplon
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Boot: Configuration</h3></div><div class="panel-body"><p>If you just want to take Hoplon for a quick ride you may skip
          this section. Just run <code>boot develpment</code> in a terminal and
          go edit <code>src/index.cljs.hl</code>. Boot will recompile
          when you save the file. Open <code>resources/public/index.html</code> on your browser to see the result.</p><p>Here is the <code>build.boot</code> file generated with the new
          project:</p><div class="highlight"><pre><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">boot</span>

<span class="o">#</span><span class="nv">tailrecursion.boot.core/version</span> <span class="s">"2.3.1"</span>

<span class="p">(</span><span class="nf">set-env!</span>
 <span class="ss">:project</span>      <span class="ss">'my-project</span>
 <span class="ss">:version</span>      <span class="s">"0.1.0-SNAPSHOT"</span>
 <span class="ss">:dependencies</span> <span class="o">'</span><span class="p">[[</span><span class="nv">tailrecursion/boot.task</span>   <span class="s">"2.1.3"</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">tailrecursion/hoplon</span>      <span class="s">"5.8.3"</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">org.clojure/clojurescript</span> <span class="s">"0.0-2202"</span><span class="p">]]</span>
 <span class="ss">:out-path</span>     <span class="s">"resources/public"</span>
 <span class="ss">:src-paths</span>    <span class="o">#</span><span class="p">{</span><span class="s">"src"</span><span class="p">})</span>

<span class="c1">;; Static resources (css, images, etc.):</span>
<span class="p">(</span><span class="nf">add-sync!</span> <span class="p">(</span><span class="nf">get-env</span> <span class="ss">:out-path</span><span class="p">)</span> <span class="o">#</span><span class="p">{</span><span class="s">"assets"</span><span class="p">})</span>

<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">tailrecursion.hoplon.boot</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>

<span class="p">(</span><span class="nf">deftask</span> <span class="nv">development</span>
  <span class="s">"Build my-project for development."</span>
  <span class="p">[]</span>
  <span class="p">(</span><span class="nb">comp </span><span class="p">(</span><span class="nf">watch</span><span class="p">)</span> <span class="p">(</span><span class="nf">hoplon</span> <span class="p">{</span><span class="ss">:prerender</span> <span class="nv">false</span> <span class="ss">:pretty-print</span> <span class="nv">true</span><span class="p">})))</span>

<span class="p">(</span><span class="nf">deftask</span> <span class="nv">production</span>
  <span class="s">"Build my-project for production."</span>
  <span class="p">[]</span>
  <span class="p">(</span><span class="nf">hoplon</span> <span class="p">{</span><span class="ss">:optimizations</span> <span class="ss">:advanced</span><span class="p">}))</span>
</pre></div><p>Let's take a look in each part of this file.</p><p>This line is the shebang. It just tells the shell to use boot to
          interpret the file.</p><div class="highlight"><pre><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">boot</span>
</pre></div><p>Here we have the version of <code>boot.core</code> used in the file.
          If you ever need to change this version, this is where you do it.</p><div class="highlight"><pre><span class="o">#</span><span class="nv">tailrecursion.boot.core/version</span> <span class="s">"2.3.1"</span>
</pre></div><p>Now we use <code>set-env!</code> to configure the project. We have
          the project name, version, dependencies. They work as you would
          expect if you have some experience with <code>lein</code>.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">set-env!</span>
 <span class="ss">:project</span>      <span class="ss">'my-project</span>
 <span class="ss">:version</span>      <span class="s">"0.1.0-SNAPSHOT"</span>
 <span class="ss">:dependencies</span> <span class="o">'</span><span class="p">[[</span><span class="nv">tailrecursion/boot.task</span>   <span class="s">"2.1.3"</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">tailrecursion/hoplon</span>      <span class="s">"5.8.3"</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">org.clojure/clojurescript</span> <span class="s">"0.0-2202"</span><span class="p">]]</span>
 <span class="ss">:out-path</span>     <span class="s">"resources/public"</span>
 <span class="ss">:src-paths</span>    <span class="o">#</span><span class="p">{</span><span class="s">"src"</span><span class="p">})</span>
</pre></div><p>The other keys in <code>set-env!</code> are important when building
          Hoplon applications. Understanding how these keys work will help you
          to organize your Hoplon project in a way that works best for your
          workflow and deployment situation.</p><dl class="dl-horizontal"><dt><tt>:out-path</tt></dt><dd><p>The output directory for the Hoplon compiler. HTML and
              static content ends up here. This is where you point your
              webserver's document root.</p></dd><dt><tt>:src-paths</tt></dt><dd><p>A set of paths in which the build process looks for source
              files to compile. These directories can contain Hoplon,
              Clojure, ClojureScript, JavaScript, or any other type of
              source file. The various compilers generally dispatch on
              filename extension, so the directory structure is pretty
              much up to you. The file watcher monitors these directories
              for changes and recompiles the project when necessary.</p></dd></dl><p>You can use <code>add-sync!</code> to instruct boot to copy files
          when it compiles your project. This line tells boot to copy what
          is inside <code>assets</code> and put in the <code>:out-path</code>, that is pointing to <code>resources/public</code>. This way you
          can put static assets in the <code>assets</code> folder and they
          will be available on <code>resources/public</code>.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">add-sync!</span> <span class="p">(</span><span class="nf">get-env</span> <span class="ss">:out-path</span><span class="p">)</span> <span class="o">#</span><span class="p">{</span><span class="s">"assets"</span><span class="p">})</span>
</pre></div><p><code>add-sync!</code> will respect the folder structure when copying
          the files. And if you want, you could keep your css, js and images
          files in separared folders and use <code>add-sync!</code> on each
          one to copy them to the output folder.</p><p>Your new Hoplon project includes a <code>.gitignore</code> file.
          The boot watch task uses your <tt>git(1)</tt> configuration to
          determine which files will trigger recompiling and which will be
          ignored.</p><p><code>require</code> works like in clojure. Here we are making
          the code on the <code>tailrecursion.hoplon.boot</code> namespace
          available.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">tailrecursion.hoplon.boot</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">])</span>
</pre></div><p>Now we have the boot tasks. The first one is the <code>development</code> task. It is a composition of two other,
          tasks from the namespace required above: <code>watch</code> and <code>hoplon</code>. We also give some options to the hoplon task.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">deftask</span> <span class="nv">development</span>
  <span class="s">"Build my-project for development."</span>
  <span class="p">[]</span>
  <span class="p">(</span><span class="nb">comp </span><span class="p">(</span><span class="nf">watch</span><span class="p">)</span> <span class="p">(</span><span class="nf">hoplon</span> <span class="p">{</span><span class="ss">:prerender</span> <span class="nv">false</span> <span class="ss">:pretty-print</span> <span class="nv">true</span><span class="p">})))</span>
</pre></div><p>The <code>watch</code> task makes boot recompile the project
          when you save your files. And the <code>hoplon</code> one tells
          boot that it is a hoplon project, so it needs to be compiled in
          a certain way.</p><p>Then you can run <code>boot development</code> in a terminal.
          Boot will compile the Hoplon project and will watch for changes
          on the project files. When files change it recompiles automatically.</p><p>Another example of boot task is the <code>production</code> one.
          You probably know what it does. It compiles the Hoplon project
          using advanced ClojureScript compilation. You can use it running<code>boot production</code> in a terminal.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">deftask</span> <span class="nv">production</span>
  <span class="s">"Build my-project for production."</span>
  <span class="p">[]</span>
  <span class="p">(</span><span class="nf">hoplon</span> <span class="p">{</span><span class="ss">:optimizations</span> <span class="ss">:advanced</span><span class="p">}))</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Hoplon: Source Files</h3></div><div class="panel-body"><div><p>Hoplon compiles files having the <code>.hl</code> filename extension. These files may be Hoplon pages, which will be compiles to single-page apps, or ClojureScript namespaces.</p><p>The first form in the file must be a page or namespace declaration. Page declarations specify the output HTML file path relative to the <code>:out-path</code> directory configured in the project <code>build.boot</code> file — <code>resources/public</code> by default. Namespace declarations are the same as in ClojureScript.</p><p>In both cases, however, the Hoplon compiler refers vars and macros from the Hoplon and Javelin namespaces into the file namespace so that adding <code>:refer</code> clauses for things like <code>div</code>, <code>span</code>, etc. are not necessary. A special <code>:refer-hoplon</code> clause can be used to selectively exclude vars that are to be redefined in the file.</p></div><p class="text-muted">Example page declaration:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"foo/bar.html"</span>
  <span class="p">(</span><span class="ss">:refer-hoplon</span> <span class="ss">:exclude</span> <span class="p">[</span><span class="nv">div</span> <span class="nv">span</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:refer-clojure</span> <span class="ss">:exclude</span> <span class="p">[</span><span class="nv">int</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">clojure.set</span> <span class="ss">:as</span> <span class="nv">set</span><span class="p">]</span>
   <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">string</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:require-macros</span>
   <span class="p">[</span><span class="nv">foo.bar.baz</span> <span class="ss">:as</span> <span class="nv">baz</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">quux</span><span class="p">]]))</span>
</pre></div><p class="text-muted">Example namespace declaration:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">foo.bar</span>
  <span class="p">(</span><span class="ss">:refer-hoplon</span> <span class="ss">:exclude</span> <span class="p">[</span><span class="nv">div</span> <span class="nv">span</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:refer-clojure</span> <span class="ss">:exclude</span> <span class="p">[</span><span class="nv">int</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">clojure.set</span> <span class="ss">:as</span> <span class="nv">set</span><span class="p">]</span>
   <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">string</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:require-macros</span>
   <span class="p">[</span><span class="nv">foo.bar.baz</span> <span class="ss">:as</span> <span class="nv">baz</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">quux</span><span class="p">]]))</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Hoplon: Page Anatomy</h3></div><div class="panel-body"><p>Hoplon page source files have three parts: the page
          declaration, optional definitions and top-level forms, and
          the page markup.</p><h6>ClojureScript syntax</h6><p class="text-muted">The page declaration:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">page</span> <span class="s">"index.html"</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">string</span><span class="p">]))</span>
</pre></div><p class="text-muted">Optional top-level forms and definitions:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">add1</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">x</span><span class="p">))</span>
</pre></div><p class="text-muted">The page markup:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">html</span>
  <span class="p">(</span><span class="nf">head</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">body</span>
    <span class="p">(</span><span class="nf">h1</span> <span class="s">"hello, number "</span> <span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">add1</span> <span class="mi">41</span><span class="p">)))))</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Hoplon: ClojureScript Markup Syntax</h3></div><div class="panel-body"><p>Hoplon's HTML evaluator provides a ClojureScript-based HTML syntax
          and semantic. Elements in ClojureScript markup are parenthesized
          lists, the same as Lisp expressions. The form in function position is
          the element’s HTML tag. Hoplon adds semantics for setting attributes
          and appending children. Consider a typical snippet of HTML markup:</p><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"greet"</span> <span class="na">class=</span><span class="s">"active"</span><span class="nt">&gt;</span>
<span class="nt">&lt;h1&gt;</span>Hello, world!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>I'm new here.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div><p>This snippet can be expressed in ClojureScript markup like this:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">div</span> <span class="ss">:id</span> <span class="s">"greet"</span> <span class="ss">:class</span> <span class="s">"active"</span>
  <span class="p">(</span><span class="nf">h1</span> <span class="s">"Hello, world!"</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">p</span> <span class="s">"I'm new here."</span><span class="p">))</span>
</pre></div><p>Notice how attributes can be set by passing them in first as
          alternating keyword/string pairs. The rest of the arguments are
          appended to the element (the div in this case) as children.</p><p>Sometimes it’s more convenient to specify the attributes as a
          map, like this:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">div</span> <span class="p">{</span><span class="ss">:id</span> <span class="s">"greet"</span> <span class="ss">:class</span> <span class="s">"active"</span><span class="p">}</span>
  <span class="p">(</span><span class="nf">h1</span> <span class="s">"Hello, world!"</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">p</span> <span class="s">"I'm new here."</span><span class="p">))</span>
</pre></div><p>Additionally, Hoplon provides semantics for anonymous tags in
          ClojureScript markup. There is, of course, no such thing in HTML
          markup. The same snippet can be expressed using an anonymous tag:</p><div class="highlight"><pre><span class="p">((</span><span class="nf">div</span> <span class="ss">:id</span> <span class="s">"greet"</span> <span class="ss">:class</span> <span class="s">"active"</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">h1</span> <span class="s">"Hello, world!"</span><span class="p">)</span>
 <span class="p">(</span><span class="nf">p</span> <span class="s">"I'm new here."</span><span class="p">))</span>
</pre></div><p>It’s important to understand that the <code>div</code>, <code>h1</code>, and <code>p</code> forms are ClojureScript
          functions that return DOM elements. DOM elements implement the <code>IFn</code> protocol to achieve the HTML semantic. This means
          that they can be used to form abstractions:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">active</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">kids</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">apply </span><span class="p">(</span><span class="nf">div</span> <span class="ss">:class</span> <span class="s">"active"</span><span class="p">)</span> <span class="nv">kids</span><span class="p">))</span>
</pre></div><p>And then, in the page markup or in a function:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">active</span> <span class="ss">:id</span> <span class="s">"greet"</span>
        <span class="p">(</span><span class="nf">h1</span> <span class="s">"Hello, world!"</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">p</span> <span class="s">"I'm new here."</span><span class="p">))</span>
</pre></div><p>Or in HTML markup in the page, even:</p><div class="highlight"><pre><span class="nt">&lt;active</span> <span class="na">id=</span><span class="s">"greet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;h1&gt;</span>Hello, world!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>I'm new here.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/active&gt;</span>
</pre></div><p>The result is equivalent to the previous snippets, but more
          general. These “custom tags” can be used in the page markup like
          any of the built-in tags.</p><p>Finally, sequences or vectors can be used to splice children
          into the parent similar to how the <code>unquote-splicing</code> form works in Clojure. For instance this,</p><div class="highlight"><pre><span class="p">(</span><span class="nf">ul</span> <span class="ss">:class</span> <span class="s">"my-list"</span>
  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nf">li</span> <span class="ss">:class</span> <span class="s">"my-item"</span> <span class="nv">%</span><span class="p">)</span> <span class="p">[</span><span class="s">"item1"</span> <span class="s">"item2"</span><span class="p">]))</span>
</pre></div><p>is equivalent to this:</p><div class="highlight"><pre><span class="p">(</span><span class="nb">apply </span><span class="p">(</span><span class="nf">ul</span> <span class="ss">:class</span> <span class="s">"my-list"</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nf">li</span> <span class="ss">:class</span> <span class="s">"my-item"</span> <span class="nv">%</span><span class="p">)</span> <span class="p">[</span><span class="s">"item1"</span> <span class="s">"item2"</span><span class="p">]))</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Hoplon: Reader Support For Multiline Strings</h3></div><div class="panel-body"><div><p>As described above, text nodes are expressed as strings in ClojureScript syntax markup, and as text contents of HTML nodes in HTML syntax. This is sometimes inconvenient, especially with preformatted text, because of issues with indentation and escaping reserved characters.</p><p>The Hoplon compiler adds a multiline string delimited mode to the reader as a preprocessor pass. Lines in the source file containing only whitespace and <code> ;;{{</code> or <code>;;}}</code> denote the start and end, respectively, of multiline text blocks. These text blocks will be transformed to strings which will be passed on to the reader with proper escaping and with leading whitespace indentation removed. The indentation level is set by the indentation of the initial <code> ;;{{</code> delimiter.</p></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Hoplon: Making the DOM Dynamic</h3></div><div class="panel-body"><p>DOM interactions can be divided into two categories: input and
          output. Input is how the user initiates changes to the state of
          the application, consisting of DOM events like <em>click</em>, <em>change</em>, etc. Output is how the state of
          the application is conveyed to the user, consisting of setting
          element attributes, properties, and the contents of text nodes.</p><p>In a Hoplon page input is accepted via the special <code>:on-<em>event</em></code> or <code>:<em>event</em></code>
          attributes set on DOM elements. All
          jQuery events are supported, including custom events. The value
          of this attribute is the event handler. For example:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">button</span>
  <span class="ss">:on-click</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">event</span><span class="p">]</span> <span class="p">(</span><span class="nf">handle!</span> <span class="nv">event</span><span class="p">))</span>
  <span class="s">"click this button"</span><span class="p">)</span>
</pre></div><p>Output is displayed via the special <code>:do-<em>action</em></code> or <code>:<em>action</em></code> attributes set on DOM elements. The value of these attributes is
          a formula cell whose value forms the argument to the action. For
          example:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">div</span> <span class="ss">:do-class</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">{</span><span class="ss">:active</span> <span class="p">(</span><span class="nb">= </span><span class="mi">20</span> <span class="nv">page</span><span class="p">)})</span>
  <span class="p">(</span><span class="nf">h2</span> <span class="s">"Page 20"</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">p</span> <span class="s">"This is the content for page 20."</span><span class="p">))</span>
</pre></div><p>The <code>:do-class</code> example above adds or removes the <em>“active”</em> class, depending on whether the <code>page</code> cell’s value is equal to 20 or not, respectively. This
          relationship is maintained automatically, reactively keeping the
          element’s class in sync with the formula.</p><p>The <code>text</code> macro creates DOM text nodes whose content
          automatically updates itself, interpolating cell values and/or
          formulas in the argument string. For example if you have a cell <code>x</code>:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">p</span> <span class="p">(</span><span class="nf">text</span> <span class="s">"the value of x is ~{x}"</span><span class="p">))</span>
</pre></div><p>This creates a paragraph whose text content is linked to the
          interpolated string.</p><p>Output and input wiring can also be done programmatically using
          the <code>do!</code> and <code>on!</code> multimethods. For
          instance, to set the <em>“active”</em> class on element <code>elem</code>, one would do:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">do!</span> <span class="nv">elem</span> <span class="ss">:class</span> <span class="p">{</span><span class="ss">:active</span> <span class="nv">true</span><span class="p">})</span>
</pre></div><p>And to add a handler for the <em>click</em> event one would do:</p><div class="highlight"><pre><span class="p">(</span><span class="nf">on!</span> <span class="nv">elem</span> <span class="ss">:click</span> <span class="o">#</span><span class="p">(</span><span class="nf">handle!</span> <span class="nv">%</span><span class="p">))</span>
</pre></div><p>It's important to note the these are not reactive. They're just
          regular functions operating on regular data, not cells. To achieve
          the reactive behavior of the <code>:do-class</code> example above
          the expression can be used as the formula of an anonymous cell
          (anonymous because output is only for side-effects–mutating the
          DOM in this case):</p><div class="highlight"><pre><span class="p">(</span><span class="nf">cell=</span> <span class="p">(</span><span class="nf">do!</span> <span class="nv">elem</span> <span class="ss">:class</span> <span class="p">{</span><span class="ss">:active</span> <span class="p">(</span><span class="nb">= </span><span class="mi">20</span> <span class="nv">page</span><span class="p">)}))</span>
</pre></div><p>Event handlers are normally set just once, so formula cells don’t
          usually make sense in combination with the <code>on!</code> method. This illustrates the I/O model in Hoplon: output
          reactively updates the DOM in relation to the underlying state via
          formula cells, while input updates the underlying state via events
          emitted by the DOM.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Hoplon: External JS Libs And Extern Files</h3></div><div class="panel-body"><p>External JavaScript libraries can be prepended to the <code>main.js</code> file emitted by the ClojureScript compiler and
          extern files for them can be included in the compilation of the
          application code by placing the files in a source directory (one
          listed in <code>:src-paths</code> on <code>build.boot</code> — <code>src</code> by default) and using a special naming
          convention.</p><ul><li>External JS files use the <code>.inc.js</code> extension</li><li>Extern files for GClosure use the <code>.ext.js</code> extension</li></ul><p>External JS files will be prepended to the <code>main.js</code> file
          in alphabetical order.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Javelin</h3></div><div class="panel-body"><p>You can find documentation about Javelin — cells and formula cells —
          on the <a shape="rect" href="https://github.com/tailrecursion/javelin#overview">Javelin project page</a>.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra</h3></div><div class="panel-body"><p>Castra is the RPC library that comes with Hoplon. It allows the
          illusion of client calling functions defined on the server.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Creating a project</h3></div><div class="panel-body"><p>To create a new Hoplon project with Castra you can use <code>lein</code>:</p><div class="highlight"><pre><span class="nv">$ </span>lein new hoplon-castra my-project
</pre></div><p>We will take a look on some of the files from the generated
          project on the next sections.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Server side rpc</h3></div><div class="panel-body"><p>Let's take a look on <code>src/clj/my_project/api.clj</code> of
          the generated project.</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.api</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">tailrecursion.castra</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defrpc</span><span class="p">]]))</span>

<span class="p">(</span><span class="nf">defrpc</span> <span class="nv">get-state</span> <span class="p">[]</span>
  <span class="p">{</span><span class="ss">:random</span> <span class="p">(</span><span class="nb">rand-int </span><span class="mi">100</span><span class="p">)})</span>
</pre></div><p><code>defrpc</code> accepts a map like the pre- and postconditions
          map that regular Clojure functions can use. You may use two
          special keys in this map: <code>:rpc/pre</code> and <code>:rpc/query</code>.</p><p>The <code>:rpc/pre</code> value is a vector of expressions. The
          expressions inside the vector are evaluated and if any of them
          returns false or nil an assertion error is thrown. You can then
          deal with the error on the client. The <code>:rpc/pre</code> code
          is only evaluated at the entry point. That means that if the client
          calls a rpc A the <code>:rpc/pre</code> of A is
          evaluated. But if in A there is a call to rpc B which also
          has <code>:rpc/pre</code> it will not be executed when it is called
          from A.</p><p>The <code>:rpc/query</code> value is also a vector of expressions,
          but it should only have one expression. The vector content will be
          the response. So when <code>:rpc/query</code> is present, the body
          is only evaluated for side-effects.</p><p>Let's rewrite the <code>get-state</code> rpc using <code>:rpc/pre</code> and <code>:rpc/query</code>. Pretend that <code>login!</code> is a function that returns true if the user
          is logged in and false otherwise.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">defrpc</span> <span class="nv">get-state</span> <span class="p">[]</span>
  <span class="p">{</span><span class="ss">:rpc/pre</span> <span class="p">[(</span><span class="nf">login!</span><span class="p">)]</span>
   <span class="ss">:rpc/query</span> <span class="p">[{</span><span class="ss">:random</span> <span class="p">(</span><span class="nb">rand-int </span><span class="mi">100</span><span class="p">)}]}</span>
  <span class="s">"The function body only matters for side-effects when</span>
<span class="s">you use the special :rpc/query key."</span><span class="p">)</span>
</pre></div><p>If you are using this special map, the rpc needs a body. It
          can even be <code>nil</code> but it needs something in it, or it
          will consider the map as a regular body and use it as the response
          value.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Server configuration</h3></div><div class="panel-body"><p>Now you have functions, but your client cannot reach them just yet.
          Some server configuration is necessary. Castra provides a Ring
          handler that listens to Castra POST requests. These requests
          contain the function that should be called on the server. The handler
          is called <code>castra</code> and is located on the <code>tailrecursion.castra.handler</code> namespace. One form to use
          the handler can be found in the <code>core.clj</code> file on the
          generated project:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.core</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">ring.adapter.jetty</span>               <span class="ss">:refer</span> <span class="p">[</span><span class="nv">run-jetty</span><span class="p">]]</span>
   <span class="p">[</span><span class="nv">ring.middleware.resource</span>         <span class="ss">:refer</span> <span class="p">[</span><span class="nv">wrap-resource</span><span class="p">]]</span>
   <span class="p">[</span><span class="nv">ring.middleware.session</span>          <span class="ss">:refer</span> <span class="p">[</span><span class="nv">wrap-session</span><span class="p">]]</span>
   <span class="p">[</span><span class="nv">ring.middleware.session.cookie</span>   <span class="ss">:refer</span> <span class="p">[</span><span class="nv">cookie-store</span><span class="p">]]</span>
   <span class="p">[</span><span class="nv">ring.middleware.file</span>             <span class="ss">:refer</span> <span class="p">[</span><span class="nv">wrap-file</span><span class="p">]]</span>
   <span class="p">[</span><span class="nv">ring.middleware.file-info</span>        <span class="ss">:refer</span> <span class="p">[</span><span class="nv">wrap-file-info</span><span class="p">]]</span>
   <span class="p">[</span><span class="nv">tailrecursion.castra.handler</span>     <span class="ss">:refer</span> <span class="p">[</span><span class="nv">castra</span><span class="p">]]))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">app</span> <span class="p">[</span><span class="nv">port</span> <span class="nv">public-path</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">-&gt; </span><span class="p">(</span><span class="nf">castra</span> <span class="ss">'my-project.api</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">wrap-session</span> <span class="p">{</span><span class="ss">:store</span> <span class="p">(</span><span class="nf">cookie-store</span> <span class="p">{</span><span class="ss">:key</span> <span class="s">"a 16-byte secret"</span><span class="p">})})</span>
      <span class="p">(</span><span class="nf">wrap-file</span> <span class="nv">public-path</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">wrap-file-info</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">run-jetty</span> <span class="p">{</span><span class="ss">:join?</span> <span class="nv">false</span> <span class="ss">:port</span> <span class="nv">port</span><span class="p">})))</span>
</pre></div><p>You give <code>castra</code> the namespaces where there are
          functions you want to call from the client. While developing, there
          is no need to worry about the server setup. There is a <code>develoment</code> task in the generated project that takes care
          of this step. Just remember to add any other namespaces on your <code>build.boot</code> when necessary.</p><p>Notice that you expose every function and rpc in the namespace.
          You can control that using <code>:only</code> and <code>:exclude</code> to choose which rpcs and functions will be exposed or which ones
          won't be.</p><div class="highlight"><pre><span class="c1">;; Only foo, bar and baz can be accessed from the client:</span>
<span class="p">(</span><span class="nf">castra</span> <span class="o">'</span><span class="p">[</span><span class="nv">my-project.api</span> <span class="ss">:only</span> <span class="p">[</span><span class="nv">foo</span> <span class="nv">bar</span> <span class="nv">baz</span><span class="p">]])</span>

<span class="c1">;; foo, bar and baz cannot be accessed from the client:</span>
<span class="p">(</span><span class="nf">castra</span> <span class="o">'</span><span class="p">[</span><span class="nv">my-project.api</span> <span class="ss">:exclude</span> <span class="p">[</span><span class="nv">foo</span> <span class="nv">bar</span> <span class="nv">baz</span><span class="p">]])</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Client side - mkremote</h3></div><div class="panel-body"><p>On the client side we need the <code>mkremote</code> function from <code>tailrecursion.castra</code> namespace. Let's have a look on the
          generated <code>rpc.cljs</code> file:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.rpc</span>
  <span class="p">(</span><span class="ss">:require-macros</span>
   <span class="p">[</span><span class="nv">tailrecursion.javelin</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defc</span> <span class="nv">defc=</span><span class="p">]])</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">tailrecursion.javelin</span><span class="p">]</span>
   <span class="p">[</span><span class="nv">tailrecursion.castra</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">mkremote</span><span class="p">]]))</span>

<span class="p">(</span><span class="nf">defc</span> <span class="nv">state</span> <span class="p">{</span><span class="ss">:random</span> <span class="nv">nil</span><span class="p">})</span>
<span class="p">(</span><span class="nf">defc</span> <span class="nv">error</span> <span class="nv">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nf">defc</span> <span class="nv">loading</span> <span class="p">[])</span>

<span class="p">(</span><span class="nf">defc=</span> <span class="nv">random-number</span> <span class="p">(</span><span class="nb">get </span><span class="nv">state</span> <span class="ss">:random</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">get-state</span>
  <span class="p">(</span><span class="nf">mkremote</span> <span class="ss">'my-project.api/get-state</span> <span class="nv">state</span> <span class="nv">error</span> <span class="nv">loading</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">init</span> <span class="p">[]</span>
  <span class="p">(</span><span class="nf">get-state</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">js/setInterval</span> <span class="nv">get-state</span> <span class="mi">1000</span><span class="p">))</span>
</pre></div><p>We need to require <code>tailrecursion.javelin</code> for the <code>state</code>, <code>error</code> and <code>loading</code> cells. <code>mkremote</code> takes a quoted namespaced function and three
          cells as arguments and it returns a function. The namespaced function
          is the one that will be called on the server. The returned function
          can be called on the client with any arguments that will also be
          passed to the function called on the server.</p><p><code>mkremote</code> sends the POST request to the url the user
          is by default. But you can bind the <code>*url*</code> dynamic var
          to make it POST to any url you want:</p><div class="highlight"><pre><span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*url*</span> <span class="s">"/foo/bar/"</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">mkremote</span> <span class="nv">...</span><span class="p">))</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Client side - state cell</h3></div><div class="panel-body"><p>When the function succeeds the <code>state</code> cell is updated
          with the return value. When there is an error, the <code>state</code> cell doesn't change, so it stays with the last "good" state.</p><p>You should use the state to create views for you users. It's common
          to use formula cells to separate the state in more manageable
          pieces.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Client side - error cell</h3></div><div class="panel-body"><p>When the function call returns an error, the error cell will be
          updated. One possible error is when you can't reach the server.
          Let's take a look at the contents of the <code>error</code> cell
          after the error occurred:</p><div class="highlight"><pre><span class="p">{</span><span class="ss">:type</span> <span class="ss">:tailrecursion.castra/exception</span>
 <span class="ss">:isa</span> <span class="o">#</span><span class="p">{}</span>
 <span class="ss">:message</span> <span class="s">"The server is temporarily unavailable."</span>
 <span class="ss">:data</span> <span class="nv">nil</span>
 <span class="ss">:cause</span> <span class="p">[</span><span class="s">"Unexpected end of input"</span><span class="p">]</span>
 <span class="ss">:trace</span> <span class="s">""</span>
 <span class="ss">:status</span> <span class="mi">500</span>
 <span class="ss">:severity</span> <span class="ss">:error</span><span class="p">}</span>
</pre></div><p>You could then use a formula cell to display the error message to
          the user. You should also clear the error cell after you deal with
          it.</p><p>Another error could be a failure in the <code>:rpc/pre</code> condition on the server. Here what is the error when you just put <code>false</code> there.</p><div class="highlight"><pre><span class="p">{</span><span class="ss">:type</span> <span class="ss">:tailrecursion.castra/fatal</span>
 <span class="ss">:isa</span> <span class="o">#</span><span class="p">{</span><span class="ss">:tailrecursion.castra/exception</span><span class="p">}</span>
 <span class="ss">:message</span> <span class="s">"Server error."</span>
 <span class="ss">:data</span> <span class="nv">nil</span>
 <span class="ss">:cause</span> <span class="p">[</span><span class="s">"Assert failed: (if G__11117 (clojure.core/and false) true)"</span><span class="p">]</span>
 <span class="ss">:trace</span> <span class="s">"clojure.lang.ExceptionInfo: Server error.\n</span>
<span class="s">at clojure.core$ex_info.invoke (core.clj:4327)\n</span>
<span class="s">... and the rest of the stacktrace from the server</span>
<span class="s">(omitted for brevity)."</span>
 <span class="ss">:status</span> <span class="mi">500</span>
 <span class="ss">:severity</span> <span class="ss">:fatal</span><span class="p">}</span>
</pre></div><p>If you are using the <code>:rpc/pre</code> condition for access
          control, this could mean a login failure.</p><p>You can also throw custom errors on the server, there are several
          already defined on <code>tailrecursion.castra</code> like the <code>auth</code> error shown below:</p><div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">my-project.api</span>
  <span class="p">(</span><span class="ss">:require</span>
   <span class="p">[</span><span class="nv">tailrecursion.castra</span> <span class="ss">:as</span> <span class="nv">c</span><span class="p">]))</span>

<span class="p">(</span><span class="nf">throw</span> <span class="p">(</span><span class="nf">c/ex</span> <span class="nv">c/auth</span> <span class="s">"Username or password incorrect"</span> <span class="p">{</span><span class="ss">:some</span> <span class="s">"data"</span><span class="p">}))</span>
</pre></div><p>This will give the following error on the client:</p><div class="highlight"><pre><span class="p">{</span><span class="ss">:type</span> <span class="ss">:tailrecursion.castra/auth</span>
 <span class="ss">:isa</span> <span class="o">#</span><span class="p">{</span><span class="ss">:tailrecursion.castra/exception</span><span class="p">}</span>
 <span class="ss">:message</span> <span class="s">"Username or password incorrect"</span>
 <span class="ss">:data</span> <span class="p">{</span><span class="ss">:some</span> <span class="s">"data"</span><span class="p">}</span>
 <span class="ss">:cause</span> <span class="p">[]</span>
 <span class="ss">:trace</span> <span class="s">"... (omitted for brevity)."</span>
 <span class="ss">:status</span> <span class="mi">403</span>
 <span class="ss">:severity</span> <span class="ss">:error</span><span class="p">}</span>
</pre></div><p>The errors have different <code>:message</code> and <code>:severity</code> which makes easier to decide what should
          be displayed for the user or not.</p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-primary"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Castra: Client side - loading cell</h3></div><div class="panel-body"><p>While any <code>mkremote</code> calls are in progress, the loading
          cell won't be empty. After every remote function returns the loading
          cell will be empty again. You can use that to show a loading
          indicator.</p><div class="highlight"><pre><span class="p">(</span><span class="nf">div</span> <span class="ss">:toggle</span> <span class="p">(</span><span class="nf">cell=</span> <span class="p">(</span><span class="nb">seq </span><span class="nv">loading</span><span class="p">))</span> <span class="s">"Loading ..."</span><span class="p">)</span>
</pre></div><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><hr><footer style="padding:30px 0px;"><div style="text-align:center;">Copyright © Alan Dipert and Micha Niskin. All rights reserved.</div></footer></div></div></div><div class="container" style="display: none; "><div class="row"><div class="col-md-4"><div class="panel panel-default affix hidden-xs hidden-sm"><div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div><div class="panel-body"><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li><a shape="rect" style="cursor:pointer;">Reactive web apps with Hoplon and DataScript</a></li><li><a shape="rect" style="cursor:pointer;">Clojure/West 2014 - Web Programming with Hoplon</a></li><li><a shape="rect" style="cursor:pointer;">A Quick Dashboard in Hoplon &amp; Castra</a></li><li><a shape="rect" style="cursor:pointer;">Reactive Binary Clock, Hoplon Edition</a></li><li><a shape="rect" style="cursor:pointer;">AngularJS on Hoplon</a></li></ul></div></div></div></div></div><div class="col-md-8"><a shape="rect" class="topfix"></a><h1>Talking Hoplon<br clear="none"><small>Talks and articles about Hoplon.</small></h1><hr><div class="panel panel-default hidden-md hidden-lg"><div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div><div class="panel-body"><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li><a shape="rect" style="cursor:pointer;">Reactive web apps with Hoplon and DataScript</a></li><li><a shape="rect" style="cursor:pointer;">Clojure/West 2014 - Web Programming with Hoplon</a></li><li><a shape="rect" style="cursor:pointer;">A Quick Dashboard in Hoplon &amp; Castra</a></li><li><a shape="rect" style="cursor:pointer;">Reactive Binary Clock, Hoplon Edition</a></li><li><a shape="rect" style="cursor:pointer;">AngularJS on Hoplon</a></li></ul></div></div></div></div><div class="panel panel-default panel-info"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Reactive web apps with Hoplon and DataScript</h3></div><div class="panel-body"><p>Daniel Neal briefly introduces Hoplon, then semi
          live-codes an application combining Hoplon and DataScript.</p><p><a shape="rect" href="https://skillsmatter.com/skillscasts/5380-reactive-web-apps-with-hoplon-and-datascript" target="_blank">https://skillsmatter.com/skillscasts/5380-reactive-web-apps-with-hoplon-and-datascript</a></p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-info"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Clojure/West 2014 - Web Programming with Hoplon</h3></div><div class="panel-body"><p>Alan Dipert and Micha Niskin talked about Hoplon and Undead
          Technology. Just follow the link:</p><p><a shape="rect" href="https://www.youtube.com/watch?v=wVXjExRiFy0" target="_blank">https://www.youtube.com/watch?v=wVXjExRiFy0</a></p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-info"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">A Quick Dashboard in Hoplon &amp; Castra</h3></div><div class="panel-body"><p><a shape="rect" href="http://blog.mattgauger.com/" target="_blank">Matt Gauger</a> shows how he would build a Dashboard using Hoplon and Castra.
          Check it out:</p><p><a shape="rect" href="http://blog.mattgauger.com/blog/2014/03/20/a-quick-dashboard-in-hoplon-and-castra/" target="_blank">http://blog.mattgauger.com/blog/2014/03/20/a-quick-dashboard-in-hoplon-and-castra/</a></p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-info"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">Reactive Binary Clock, Hoplon Edition</h3></div><div class="panel-body"><p><a shape="rect" href="https://pmbauer.github.io/" target="_blank">Paul Bauer</a> did a cool demo showing how to do a binary clock using Hoplon.
          Check it out:</p><p><a shape="rect" href="https://pmbauer.github.io/2014/01/27/hoplon-binary-clock/" target="_blank">https://pmbauer.github.io/2014/01/27/hoplon-binary-clock/</a></p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><div class="panel panel-default panel-info"><a shape="rect" class="topfix"></a><div class="panel-heading"><h3 class="panel-title">AngularJS on Hoplon</h3></div><div class="panel-body"><p><a shape="rect" href="https://yokolet.github.io/" target="_blank">Yoko Harada</a> shows how easy is to use AngularJS with Hoplon. Take a look:</p><p><a shape="rect" href="https://yokolet.github.io/2014/03/24/angularjsonhoplon/" target="_blank">https://yokolet.github.io/2014/03/24/angularjsonhoplon/</a></p><div style="text-align:center"><a shape="rect">back to top</a></div></div></div><hr><footer style="padding:30px 0px;"><div style="text-align:center;">Copyright © Alan Dipert and Micha Niskin. All rights reserved.</div></footer></div></div></div><div class="container" style="display: none; "><div class="row"><div class="col-md-3"></div><div class="col-md-6"><h2>Community</h2><p><strong>Need some help? Want to discuss something Hoplon related? No
        doubt is too small.</strong></p><dl class="dl-horizontal"><dt>Forum</dt><dd><a shape="rect" href="http://hoplon.discoursehosting.net" target="_blank">http://hoplon.discoursehosting.net</a></dd><dt>Freenode IRC</dt><dd><tt>#hoplon</tt> — <a shape="rect" href="https://webchat.freenode.net/" target="_blank">IRC webclient</a>: choose a nick and put <tt>#hoplon</tt> on the channels field.</dd></dl><hr><h2>Contribute</h2><p><strong>Found a bug? Want to contribute with some code? Found a typo?
        Any help is welcome. Open an issue or send a pull request.</strong></p><dl class="dl-horizontal"><dt>Hoplon</dt><dd><a shape="rect" href="https://github.com/tailrecursion/hoplon" target="_blank">https://github.com/tailrecursion/hoplon</a></dd><dt>Boot</dt><dd><a shape="rect" href="https://github.com/tailrecursion/boot" target="_blank">https://github.com/tailrecursion/boot</a></dd><dt>Castra</dt><dd><a shape="rect" href="https://github.com/tailrecursion/castra" target="_blank">https://github.com/tailrecursion/castra</a></dd><dt>Javelin</dt><dd><a shape="rect" href="https://github.com/tailrecursion/javelin" target="_blank">https://github.com/tailrecursion/javelin</a></dd><dt>This site</dt><dd><a shape="rect" href="https://github.com/tailrecursion/hoplon.io" target="_blank">https://github.com/tailrecursion/hoplon.io</a></dd><dt>Hoplon demos</dt><dd><a shape="rect" href="https://github.com/tailrecursion/hoplon-demos" target="_blank">https://github.com/tailrecursion/hoplon-demos</a></dd></dl><hr><h3>Special Thanks To</h3><dl class="dl-horizontal"><dt>Ray Willig</dt><dd><a shape="rect" href="https://github.com/rwillig" target="_blank">https://github.com/rwillig</a></dd><dt>Alexander Solovyov</dt><dd><a shape="rect" href="https://github.com/piranha" target="_blank">https://github.com/piranha</a></dd><dt>Kevin Lynagh</dt><dd><a shape="rect" href="http://github.com/lynaghk" target="_blank">http://github.com/lynaghk</a></dd><dt>The Flapjax Team</dt><dd><a shape="rect" href="http://www.flapjax-lang.org/" target="_blank">http://www.flapjax-lang.org/</a></dd></dl><hr><footer style="padding:30px 0px;"><div style="text-align:center;">Copyright © Alan Dipert and Micha Niskin. All rights reserved.</div></footer></div><div class="col-md-3"></div></div></div></body></html>